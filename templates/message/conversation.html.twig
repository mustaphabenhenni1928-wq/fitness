{% extends 'base.html.twig' %}

{% block title %}Conversation avec {{ otherUser.email }} - Health & Fitness{% endblock %}

{% block body %}
    <div class="container" style="max-width: 900px;">
        <div style="margin-bottom: 2rem;">
            <a href="{{ path('app_messages') }}" style="color: var(--primary); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                ← Retour à la messagerie
            </a>
            <h1 style="font-size: 2rem; font-weight: 700; margin: 0;">
                Conversation avec {{ otherUser.email }}
            </h1>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-body" style="max-height: 500px; overflow-y: auto; padding: 1.5rem;">
                {% if messages|length == 0 %}
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <p>Aucun message pour le moment. Commencez la conversation !</p>
                    </div>
                {% else %}
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        {% for message in messages %}
                            <div style="display: flex; {% if message.sender.id == app.user.id %}justify-content: flex-end{% else %}justify-content: flex-start{% endif %};">
                                <div style="max-width: 70%;">
                                    <div style="background: {% if message.sender.id == app.user.id %}#777df2{% else %}#e0e0e0{% endif %}; 
                                                color: {% if message.sender.id == app.user.id %}white{% else %}inherit{% endif %}; 
                                                padding: 1rem; 
                                                border-radius: 12px; 
                                                word-wrap: break-word;">
                                        <p style="margin: 0; white-space: pre-wrap;">{{ message.content }}</p>
                                    </div>
                                    <div style="font-size: 0.75rem; color: var(--gray); margin-top: 0.25rem; padding: 0 0.5rem;">
                                        {{ message.createdAt|date('d/m/Y à H:i') }}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <div style="display: flex; gap: 1rem;">
                        <textarea 
                            name="content" 
                            class="form-control" 
                            rows="3" 
                            placeholder="Tapez votre message..." 
                            required
                            style="flex: 1; resize: vertical; min-height: 80px;"></textarea>
                        <button type="submit" class="btn btn-primary" style="align-self: flex-end; padding: 0.75rem 2rem;">
                            Envoyer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

